# 战略路线图（Strategic Roadmap）

> **当前状态**：项目处于严肃的重构/清理阶段，架构划分需要明确。

---

## 🎯 战略层次概览

```
┌─────────────────────────────────────────────────────────────┐
│                    L0: 战略目标 (Strategic)                  │
│  "可替换 Go sing-box 的生产就绪 Rust 实现"                   │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│ L1: 架构整固  │     │ L2: 功能对齐  │     │  L3: 质量保障 │
│  (Foundation) │     │   (Parity)    │     │   (Quality)   │
└───────────────┘     └───────────────┘     └───────────────┘
        │                     │                     │
        ▼                     ▼                     ▼
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│ L4: 具体任务  │     │ L4: 具体任务  │     │ L4: 具体任务  │
│   (Tasks)     │     │    (Tasks)    │     │    (Tasks)    │
└───────────────┘     └───────────────┘     └───────────────┘
```

---

## L0: 战略目标

**最终目标**：产出可直接替换 Go sing-box 的 Rust 二进制文件，与 GUI.for" SingBox 完全兼容。

**成功指标**：
- [ ] GUI.for" SingBox 无感知替换内核
- [ ] 所有用户配置文件兼容
- [ ] Trojan + Shadowsocks 100% 可用
- [ ] 稳定运行 7 天无故障

---

## L1: 架构整固（当前阶段 🔴）

### 目标
解决架构混乱问题，建立清晰的模块边界。

### 里程碑

#### M1.1: 依赖边界硬化 ⬜ 未开始
- [ ] CI 强制执行依赖方向检查
- [ ] sb-core 移除所有协议实现依赖
- [ ] sb-types 移除所有运行时依赖
- [ ] 验收：`cargo tree` 检查全部通过

#### M1.2: 代码归属清理 ⬜ 未开始
- [ ] 协议实现全部迁移到 sb-adapters
- [ ] 平台服务全部迁移到 sb-platform
- [ ] sb-core 只保留引擎逻辑
- [ ] 验收：grep 检查无越界代码

#### M1.3: 接口契约明确 ⬜ 未开始
- [ ] sb-types 定义所有 Ports traits
- [ ] 控制面/数据面接口分离
- [ ] 验收：sb-core 可独立单测

---

## L2: 功能对齐

### 目标
达成与 Go sing-box 1.12.14 的功能对等。

### 当前状态
- **总体对齐率**: 88% (183/209)
- **协议对齐**: 100%
- **服务对齐**: 部分

### 里程碑

#### M2.1: 核心协议验证 ✅ 已完成
- [x] Trojan inbound/outbound
- [x] Shadowsocks 全套（多用户、AEAD）
- [x] SOCKS5/HTTP 代理
- [x] TUN 支持

#### M2.2: 缺口修复 ⬜ 进行中
- [ ] V2Ray API gRPC 完整实现
- [ ] Cache File 完整持久化
- [ ] TLS fragmentation Windows 优化
- [ ] 验收：Parity ≥ 95%

#### M2.3: CLI 兼容性 ⬜ 未开始
- [ ] 参数对齐验证
- [ ] 配置校验行为对齐
- [ ] 版本输出格式对齐
- [ ] 验收：Go/Rust CLI diff 测试

---

## L3: 质量保障

### 目标
确保实现的正确性和稳定性。

### 里程碑

#### M3.1: 测试覆盖 ⬜ 进行中
- [ ] 协议集成测试全通过
- [ ] GeoIP/GeoSite 测试数据就位
- [ ] E2E 测试框架完善
- [ ] 验收：CI 测试 100% 通过

#### M3.2: 性能基准 ⬜ 未开始
- [ ] 建立性能基准测试
- [ ] 与 Go 版本对比
- [ ] 热路径优化
- [ ] 验收：性能 ≥ Go 版本

#### M3.3: 稳定性验证 ⬜ 未开始
- [ ] 长时间运行测试
- [ ] 内存泄漏检测
- [ ] 压力测试
- [ ] 验收：7天无故障运行

---

## L4: 当前执行任务

### 本周任务队列

| 优先级 | 任务 | 状态 | 负责 |
|--------|------|------|------|
| P0 | 建立 AI 文档管理规范 | ✅ 完成 | Gemini-CLI |
| P0 | 依赖边界 CI 检查 | ⬜ 待做 | - |
| P1 | sb-core 协议代码迁移 | ⬜ 待做 | - |
| P1 | 测试数据准备 | ⬜ 待做 | - |

### 下一步行动

1. **立即**：建立 CI 依赖检查脚本
2. **短期**：完成 sb-core 清理
3. **中期**：修复 Parity 缺口
4. **长期**：稳定性验证

---

## 执行原则

### 顺序原则
```
架构整固 → 功能对齐 → 质量保障
   ↓           ↓           ↓
  先做        再做        最后做
```

### 依赖原则
- L1 完成前，不开始 L2 的新功能开发
- L2 完成前，不开始 L3 的大规模测试
- 任何时候发现架构问题，回退到 L1

### AI 协作原则
- 每个 AI 接手时，先看 `log.md` 和本文档
- 更新任务状态后，更新本文档
- 完成里程碑后，更新本文档

---

## 📊 进度追踪

| 层次 | 里程碑 | 进度 | 目标日期 |
|------|--------|------|---------|
| L1 | M1.1 依赖硬化 | 0% | TBD |
| L1 | M1.2 代码归属 | 0% | TBD |
| L1 | M1.3 接口契约 | 0% | TBD |
| L2 | M2.1 核心协议 | 100% | ✅ |
| L2 | M2.2 缺口修复 | 20% | TBD |
| L2 | M2.3 CLI 兼容 | 0% | TBD |
| L3 | M3.1 测试覆盖 | 30% | TBD |
| L3 | M3.2 性能基准 | 0% | TBD |
| L3 | M3.3 稳定验证 | 0% | TBD |

---

*本文档是项目战略的唯一真相。所有 AI 工作应对齐到这些目标。*
