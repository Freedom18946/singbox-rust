# TLS åº“ç­–ç•¥å†³ç­–æ–‡æ¡£

> **çŠ¶æ€**: ğŸ“‹ è¯„ä¼°å®Œæˆ | **ä¼˜å…ˆçº§**: ä¸­ | **å½±å“**: åè®®å…¼å®¹æ€§

---

## æ‰§è¡Œæ‘˜è¦

Go sing-box ä½¿ç”¨ `refraction-networking/utls` å®ç°å­—èŠ‚çº§ TLS æŒ‡çº¹æ¨¡æ‹Ÿã€‚Rust å®ç°ä½¿ç”¨ `rustls` é…åˆè‡ªå®šä¹‰æ‰©å±•é¡ºåºæ¨¡æ‹Ÿã€‚ä¸¤è€…åœ¨åŠŸèƒ½ä¸Šè¾¾åˆ° ~90% å¯¹ç­‰,ä½† Rust åœ¨é«˜çº§åœºæ™¯ (ECH, PSK, ç²¾ç¡®å­—èŠ‚åº) æœ‰é™åˆ¶ã€‚

---

## ç°çŠ¶åˆ†æ

### Rust sb-tls å®ç° (sb-tls/src/utls.rs)

**ä»£ç è§„æ¨¡**: 784 è¡Œ

**æ”¯æŒæŒ‡çº¹** (30+):
- Chrome: 58, 62, 70, 72, 83, 87, 96, 100, 102, 106, 110, 120
- Firefox: 55, 56, 63, 65, 99, 102, 105
- Safari: iOS 11-16, macOS 10.x
- Edge: 85, 106
- 360/QQ Browser

**å®ç°æ–¹å¼**:
```rust
pub struct UtlsConfig {
    server_name: String,
    fingerprint: UtlsFingerprint,
    insecure: bool,
    alpn: Vec<String>,
}

impl UtlsConfig {
    pub fn build_client_config(&self) -> Arc<rustls::ClientConfig> {
        // æ ¹æ®æŒ‡çº¹é€‰æ‹© cipher suites å’Œ ALPN
        // é€šè¿‡ rustls çš„ CipherSuite é€‰æ‹©æ¨¡æ‹Ÿ
    }
}
```

### Go utls å®ç°

**åº“**: `refraction-networking/utls`

**èƒ½åŠ›**:
- å­—èŠ‚çº§ ClientHello æ§åˆ¶
- ç²¾ç¡®æ‰©å±•é¡ºåº
- PSK/ECH æ”¯æŒ
- GREASE éšæœºåŒ–

---

## å·®è·åˆ†æ

| åŠŸèƒ½ | Go (utls) | Rust (rustls) | å½±å“ |
|------|-----------|---------------|------|
| åŸºç¡€æŒ‡çº¹ | âœ… | âœ… | - |
| Cipher suite é€‰æ‹© | âœ… | âœ… | - |
| æ‰©å±•é¡ºåºæ§åˆ¶ | âœ… å®Œå…¨ | âš ï¸ æœ‰é™ | ä¸­ |
| ECH (Encrypted ClientHello) | âœ… | âŒ | é«˜ |
| PSK æ‰©å±• | âœ… | âš ï¸ æœ‰é™ | ä¸­ |
| GREASE éšæœºåŒ– | âœ… | âš ï¸ æœ‰é™ | ä½ |
| å­—èŠ‚çº§ç²¾ç¡® | âœ… | âŒ | ä¸­ |

---

## æ–¹æ¡ˆè¯„ä¼°

### æ–¹æ¡ˆ A: æ¥å—å½“å‰é™åˆ¶ (æ¨è)

**çŠ¶æ€**: ä¿æŒ rustls + è‡ªå®šä¹‰æŒ‡çº¹æ¨¡å—

| ç»´åº¦ | è¯„ä¼° |
|------|------|
| **è¦†ç›–ç‡** | ~90% ä½¿ç”¨åœºæ™¯ |
| **ç»´æŠ¤æ€§** | â­â­â­â­â­ æœ€é«˜ |
| **å®‰å…¨æ€§** | â­â­â­â­â­ rustls å®¡è®¡ |
| **å·¥ä½œé‡** | 0 (å·²å®Œæˆ) |

**é™åˆ¶**:
- ECH ä¸å¯ç”¨ (éœ€ç­‰å¾… rustls #1718)
- é«˜ç²¾åº¦æŒ‡çº¹æ£€æµ‹å¯èƒ½å¤±è´¥
- æŸäº› DPI ç³»ç»Ÿä»å¯è¯†åˆ«

### æ–¹æ¡ˆ B: è€ƒè™‘ boring-rs (BoringSSL)

**æ–¹æ³•**: ä½¿ç”¨ Google BoringSSL çš„ Rust ç»‘å®š

| ç»´åº¦ | è¯„ä¼° |
|------|------|
| **è¦†ç›–ç‡** | ~95% |
| **ç»´æŠ¤æ€§** | â­â­â­ ä¸­ç­‰ (FFI) |
| **å®‰å…¨æ€§** | â­â­â­â­ é«˜ (Chrome åŒæº) |
| **å·¥ä½œé‡** | 2-3 å‘¨ |

**ä¼˜åŠ¿**:
- æ›´å¤šæ‰©å±•æ§åˆ¶
- Google ç»´æŠ¤

**åŠ£åŠ¿**:
- éœ€è¦ C/C++ å·¥å…·é“¾
- æ„å»ºå¤æ‚æ€§å¢åŠ 

### æ–¹æ¡ˆ C: ç­‰å¾… rustls ECH æ”¯æŒ

**æ—¶é—´çº¿**: rustls ECH PR #1718 (è¿›è¡Œä¸­)

| ç»´åº¦ | è¯„ä¼° |
|------|------|
| **é¢„è®¡æ—¶é—´** | 3-6 ä¸ªæœˆ |
| **å·¥ä½œé‡** | ç›‘æ§ + é›†æˆ |

**è·Ÿè¸ª**:
- https://github.com/rustls/rustls/pull/1718
- https://github.com/rustls/rustls/issues/1189

---

## æµ‹è¯•è¦†ç›–

**sb-tls æµ‹è¯•çŠ¶æ€**: 72 tests passed âœ…

```bash
cargo test -p sb-tls
# åŒ…æ‹¬:
# - test_utls_config
# - test_fingerprint_parsing
# - test_chrome110_params
# - test_firefox105_params
```

---

## å»ºè®®

### çŸ­æœŸ (æ¥å—é™åˆ¶)

1. **ä¿æŒå½“å‰å®ç°** - rustls + UtlsConfig å·²è¦†ç›–ä¸»æµåœºæ™¯
2. **æ–‡æ¡£åŒ–é™åˆ¶** - æ ‡æ³¨ ECH ä¸å¯ç”¨
3. **æµ‹è¯•è¦†ç›–** - ç¡®ä¿ 72 æµ‹è¯•ç»§ç»­é€šè¿‡

### ä¸­æœŸ (ç›‘æ§ ECH)

1. è·Ÿè¸ª rustls ECH PR è¿›å±•
2. å‡†å¤‡ ECH é›†æˆä»£ç  (å½“ä¸Šæ¸¸åˆå¹¶æ—¶)

### é•¿æœŸ (å¯é€‰è¯„ä¼°)

1. å¦‚éœ€æ›´é«˜ä¿çœŸåº¦,è¯„ä¼° boring-rs è¿ç§»
2. éœ€æƒè¡¡æ„å»ºå¤æ‚æ€§å¢åŠ 

---

## å†³ç­–è®°å½•

| æ—¥æœŸ | å†³ç­– | ç†ç”± |
|------|------|------|
| 2025-12-16 | æ–¹æ¡ˆ A (æ¥å—é™åˆ¶) | 90% è¦†ç›–,ç»´æŠ¤æ€§æœ€é«˜,å®‰å…¨æ€§æœ€é«˜ |

---

## ç›¸å…³æ–‡æ¡£

- [sb-tls/src/utls.rs](../crates/sb-tls/src/utls.rs) - uTLS å®ç°
- [sb-tls/README.md](../crates/sb-tls/README.md) - TLS æ¨¡å—æ–‡æ¡£
- [rustls ECH Issue](https://github.com/rustls/rustls/issues/1189)
