{
  "version": 1,
  "scenes": [
    {
      "name": "http_405",
      "metrics": [
        { "key": "http_respond_total", "label": "code=\"405\"", "min": 1, "gate": 1, "owner": "http", "severity": "error" }
      ]
    },
    {
      "name": "socks5_tcp_connect",
      "metrics": [
        { "key": "proxy_select_total", "label": ".*", "min": 1, "gate": 1, "owner": "proxy", "severity": "error" }
      ]
    },
    {
      "name": "socks5_udp_direct",
      "metrics": [
        { "key": "udp_upstream_pkts_in_total", "label": ".*", "min": 1, "gate": 1, "owner": "udp", "severity": "error" }
      ]
    },
    {
      "name": "dns_dot_internal",
      "metrics": [
        { "key": "dns_query_total", "label": "backend=\"dot\"", "min": 1, "gate": 1, "owner": "dns", "severity": "error" }
      ]
    },
    {
      "name": "dns_doh_internal",
      "metrics": [
        { "key": "dns_query_total", "label": "backend=\"doh\"", "min": 1, "gate": 1, "owner": "dns", "severity": "error" }
      ]
    },
    {
      "name": "socks5_udp_upstream_conf",
      "metrics": [
        { "key": "proxy_select_total", "label": "pool=\"up#1\"", "min": 1, "gate": 1, "owner": "proxy", "severity": "error" },
        { "key": "udp_upstream_pkts_in_total", "label": ".*", "min": 1, "gate": 1, "owner": "udp", "severity": "error" }
      ]
    },
    {
      "name": "selector_p2_trend",
      "metrics": [
        { "key": "proxy_select_total", "label": "pool=\"up\",endpoint=\"up#1\"", "min": 1, "gate": 1, "owner": "proxy", "severity": "error" },
        { "key": "proxy_select_total", "label": "pool=\"up\",endpoint=\"up#2\"", "min": 1, "gate": 1, "owner": "proxy", "severity": "error" }
      ]
    },
    {
      "name": "udp_upstream_longrun",
      "metrics": [
        { "key": "udp_upstream_pkts_in_total",  "label": ".*", "min": 10,  "gate": 1, "owner": "udp", "severity": "error" },
        { "key": "udp_upstream_bytes_in_total", "label": ".*", "min": 300, "gate": 1, "owner": "udp", "severity": "error" }
      ]
    },
    {
      "name": "udp_upstream_stability",
      "metrics": [
        { "key": "udp_upstream_pkts_in_total",  "label": ".*", "min": 50,  "gate": 1, "owner": "udp", "severity": "error" },
        { "key": "udp_upstream_bytes_in_total", "label": ".*", "min": 1000, "gate": 1, "owner": "udp", "severity": "error" }
      ],
      "values": [
        { "key": "udp_upstream_map_size", "label": ".*", "op": "<=", "value": 512, "gate": 1, "owner": "udp", "severity": "error" }
      ],
      "proc_values": [
        { "key": "rss_mib", "op": "<=", "value": 256, "gate": 0, "owner": "runtime", "severity": "warn" }
      ],
      "proc_max": [
        { "key": "rss_mib", "op": "<=", "value": 300, "gate": 1, "owner": "runtime", "severity": "error" },
        { "key": "fd",      "op": "<=", "value": 2048, "gate": 1, "owner": "runtime", "severity": "error" }
      ],
      "proc_pctl_window": [
        { "key": "rss_mib", "pctl": 95, "window_sec": 10, "op": "<=", "value": 280, "gate": 1, "owner": "runtime", "severity": "error" }
      ]
    },
    {
      "name": "selector_p2_recovery",
      "metrics": [
        { "key": "proxy_select_total", "label": "pool=\"up2\",endpoint=\"up2#1\"", "min": 1, "gate": 1, "owner": "proxy", "severity": "error" },
        { "key": "proxy_select_total", "label": "pool=\"up2\",endpoint=\"up2#2\"", "min": 1, "gate": 1, "owner": "proxy", "severity": "error" }
      ],
      "compares": [
        { "key": "proxy_select_total", "left": "pool=\"up2\",endpoint=\"up2#2\"", "right": "pool=\"up2\",endpoint=\"up2#1\"", "op": ">", "gap": 10, "gate": 1, "owner": "proxy", "severity": "error" }
      ]
    }
  ]
}