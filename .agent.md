# Agent 执行规范（singbox-rust）

> **强制要求**：所有操作必须记录在日志；所有进度必须更新在进度规划文档。

## 规范依据（必须遵守）

- `singbox_archspec_v2/README.md`
- `singbox_archspec_v2/01-constitution/*`
- `singbox_archspec_v2/02-architecture/*`
- `singbox_archspec_v2/03-crates/*`
- `singbox_archspec_v2/04-interfaces/*`
- `singbox_archspec_v2/06-implementation-guides/*`

## 强制日志与进度记录

- 日志文件：`singbox_archspec_v2/08-refactor-tracking/log.md`
- 进度规划：`singbox_archspec_v2/08-refactor-tracking/整体进度规划.md`

**规则：**
- 任何阅读/分析/修改/命令/决策/验证都必须先后写入日志
- 每次操作开始前必须读取进度规划，结束后必须更新进度规划
- 未记录视为未执行

## 标准化流程（每次任务）

1. 读取 `整体进度规划.md` 并记录“本次目标/范围”到 `log.md`
2. 对照 archspec 选择依据章节并记录
3. 执行变更（每次命令/文件修改都记录到日志）
4. 运行或选择性跳过验证（必须记录原因与风险）
5. 更新 `整体进度规划.md` 的当前状态、下一步
6. 若涉及结构改动，同步更新 `PROJECT_STRUCTURE_NAVIGATION.md`

## 边界与质量门禁（硬规则）

- 依赖方向必须符合 `dependency-constitution.md`
- sb-core 禁止引入协议实现、平台服务、Web/TLS/QUIC 大库
- Ports 与错误模型必须与 `04-interfaces/*` 与 `error-model.md` 对齐
- 热路径优先 enum 分发，避免滥用 `async-trait`
- 需要引入新依赖时，先记录日志并做边界评估
